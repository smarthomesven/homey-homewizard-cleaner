<!DOCTYPE html>
<html>
  <head>
    <style>
      .error {
        color: red;
        display: none;
      }
    </style>
  </head>
  <body>
    <fieldset class="homey-form-fieldset">
      <legend class="homey-form-legend">HomeWizard Cleaner</legend>
      <br>
      <div class="homey-form-group">
        <label class="homey-form-label" for="email" data-i18n="pair.email">Email address</label>
        <input class="homey-form-input" id="email" type="text" value="" />
      </div>
      <div class="homey-form-group">
        <label class="homey-form-label" for="password" data-i18n="pair.password">Password</label>
        <input class="homey-form-input" id="password" type="password" value="" />
      </div>
    </fieldset>
    <p id="failed" class="error" data-i18n="pair.failed">Invalid credentials</p>

    <button id="save" class="homey-button-primary-full" data-i18n="settings.save">Save</button>
    <script type="text/javascript">
      const emailElement = document.getElementById('email');
      const passwordElement = document.getElementById('password');
      const errorElement = document.getElementById('failed');
      const saveElement = document.getElementById('save');
      errorElement.style.display = 'none';
        saveElement.addEventListener("click", function (e) {
          setSaving();
          const email = emailElement.value;
          const password = passwordElement.value;
          Homey.emit("login", { email: email, password: password  }).then(function (result) {
            if (result === false) {
              errorElement.style.display = 'block';
              setSave();
            }
          });
        });
        function setSave() {
          saveElement.className = 'homey-button-primary-full';
          saveElement.textContent = Homey.__('pair.save');
        }

        function setSaving() {
          saveElement.className = 'homey-button-primary-full is-loading';
          saveElement.textContent = Homey.__('pair.saving');
        }
    </script>
  </body>
</html>